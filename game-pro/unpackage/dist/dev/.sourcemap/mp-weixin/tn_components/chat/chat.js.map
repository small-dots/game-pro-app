{"version":3,"sources":["uni-app:///main.js","webpack:////Users/anzhongqi/workspace/uniapps/game-pro/game-pro/tn_components/chat/chat.vue?ccf4","webpack:////Users/anzhongqi/workspace/uniapps/game-pro/game-pro/tn_components/chat/chat.vue?3e4e","webpack:////Users/anzhongqi/workspace/uniapps/game-pro/game-pro/tn_components/chat/chat.vue?82aa","webpack:////Users/anzhongqi/workspace/uniapps/game-pro/game-pro/tn_components/chat/chat.vue?b6f0","uni-app:///tn_components/chat/chat.vue","webpack:////Users/anzhongqi/workspace/uniapps/game-pro/game-pro/tn_components/chat/chat.vue?204f","webpack:////Users/anzhongqi/workspace/uniapps/game-pro/game-pro/tn_components/chat/chat.vue?bdfc"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","textMsg","isHistoryLoading","scrollAnimation","scrollTop","scrollToView","msgList","msgImgList","myuid","RECORDER","isVoice","voiceTis","recordTis","recording","willStop","initPoint","identifier","Y","recordTimer","recordLength","AUDIO","playMsgid","VoiceTimer","popupLayerClass","hideMore","hideEmoji","emojiList","alt","onlineEmoji","windowsState","redenvelopeData","rid","from","face","blessing","money","onLoad","onShow","uni","key","success","console","lastid","type","msg","id","time","userinfo","uid","username","content","isReceived","methods","screenMsg","loadHistory","setTimeout","text","url","length","list","getMsgList","w","h","setPicSize","showMore","openDrawer","hideDrawer","chooseImage","camera","handRedEnvelopes","getImage","sourceType","sizeType","i","src","chooseEmoji","addEmoji","textareaFocus","sendText","replaceEmoji","sendMsg","addTextMsg","addVoiceMsg","addImgMsg","addRedEnvelopeMsg","addSystemTextMsg","addSystemRedEnvelopeMsg","openRedEnvelope","title","closeRedEnvelope","sendSystemMsg","toDetails","showPic","indicator","current","urls","playVoice","voiceBegin","format","recordBegin","voiceCancel","voiceIng","voiceEnd","recordEnd","clearInterval","min","sec","switchVoice","discard"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,aAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACc;;;AAGjE;AACmN;AACnN,gBAAgB,iNAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACpCA;AAAA;AAAA;AAAA;AAAi1B,CAAgB,kyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCoNr2B;EACAC;IACA;MACA;MACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAEA;;MAEA;MACAC;MAEAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;MACA;MACAC;MACAC;MAEA;MACAC;MACAC;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACAC;MACAC,YACA;QACA;QACAC;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA,IACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA,IACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA,IACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA;QACA;QACAA;MACA,GACA;MACA;MACAC;QACA;QAAA;QAAA;QAAA;QAAA;QAAA;QACA;QAAA;QAAA;QAAA;QAAA;QAAA;QAEA;QAAA;QAAA;QAAA;QAAA;QAAA;QACA;QAAA;QAAA;QAAA;QAAA;QAAA;QAEA;QAAA;QAAA;QAAA;QAAA;QAAA;QACA;QAAA;QAAA;QAAA;QAAA;QAAA;QAEA;QAAA;QAAA;QAAA;QAAA;QAAA;QACA;QAAA;QAAA;QAAA;QAAA;QAAA;QAEA;QAAA;QAAA;QAAA;QAAA;QAAA;QACA;QAAA;QAAA;QAAA;QAAA;QAAA;QAEA;QAAA;QAAA;QAAA;QAAA;QAAA;QACA;QAAA;QAAA;QAAA;QAAA;QAAA;QAEA;QAAA;QAAA;QAAA;QAAA;QAAA;QACA;QAAA;QAAA;QAAA;QAAA;QAAA;QAEA;QAAA;QAAA;QAAA;QAAA;QAAA;QACA;QAAA;QAAA;QAAA;QAAA;MACA;MACA;MACAC;MACAC;QACAC;QAAA;QACAC;QACAC;QACAC;QACAC;MACA;IACA;EACA;EACAC;IAAA;IACA;IACA;IACA;MACA;IACA;;IAEA;IACA;MACA;IACA;IACA;IACA;MACA;IACA;EAEA;EACAC;IAAA;IACA;;IAEA;IACA;IACAC;MACAC;MACAC;QACAC;QACA;QACA;QACAC;QACA;UACAC;UACAC;YACAC;YACAF;YACAG;YACAC;cACAC;cACAC;cACAhB;YACA;YACAiB;cACAhB;cACAH;cACAoB;YACA;UACA;QACA;QACA;QACAb;UACAC;QACA;MACA;IACA;EACA;EACAa;IACA;IACAC;MACA;MACA;QACA;QACA;UACA;YACA;YACA;UACA;YACA;YACA;QAAA;MAEA;QACA;QACA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;YACA;YACA;QAAA;QAEAZ;QACA;QACA;UACAA;UACAH;QACA;MACA;MACA;QACA;QACA;MACA;IACA;IAEA;IACAgB;MAAA;MACA;QACA;MACA;MACA;MACA;MACA;MACA;MACAC;QACA;QACA;UACAZ;UACAC;YACAC;YACAF;YACAG;YACAC;cACAC;cACAC;cACAhB;YACA;YACAiB;cACAM;YACA;UACA;QACA,GACA;UACAb;UACAC;YACAC;YACAF;YACAG;YACAC;cACAC;cACAC;cACAhB;YACA;YACAiB;cACAM;YACA;UACA;QACA,GACA;UACAb;UACAC;YACAC;YACAF;YACAG;YACAC;cACAC;cACAC;cACAhB;YACA;YACAiB;cACAO;cACAC;YACA;UACA;QACA,GACA;UACAf;UACAC;YACAC;YACAF;YACAG;YACAC;cACAC;cACAC;cACAhB;YACA;YACAiB;cACAO;cACAC;YACA;UACA;QACA,EACA;QACA;QACA;UACA;YACAC;YACA;UACA;UACAA;UACA;QACA;;QAEA;QACA;UACA;UACA;YACA;UACA;QAEA;;QACA;MAEA;IACA;IACA;IACAC;MACA;MACA;QACAjB;QACAC;UACAC;UACAF;UACAO;YACAM;UACA;QACA;MACA,GACA;QACAb;QACAC;UACAC;UACAF;UACAG;UACAC;YACAC;YACAC;YACAhB;UACA;UACAiB;YACAM;UACA;QACA;MACA,GACA;QACAb;QACAC;UACAC;UACAF;UACAG;UACAC;YACAC;YACAC;YACAhB;UACA;UACAiB;YACAM;UACA;QACA;MACA,GACA;QACAb;QACAC;UACAC;UACAF;UACAG;UACAC;YACAC;YACAC;YACAhB;UACA;UACAiB;YACAO;YACAC;UACA;QACA;MACA,GACA;QACAf;QACAC;UACAC;UACAF;UACAG;UACAC;YACAC;YACAC;YACAhB;UACA;UACAiB;YACAO;YACAC;UACA;QACA;MACA,GACA;QACAf;QACAC;UACAC;UACAF;UACAG;UACAC;YACAC;YACAC;YACAhB;UACA;UACAiB;YACAO;YACAI;YACAC;UACA;QACA;MACA,GACA;QACAnB;QACAC;UACAC;UACAF;UACAG;UACAC;YACAC;YACAC;YACAhB;UACA;UACAiB;YACAO;YACAI;YACAC;UACA;QACA;MACA,GACA;QACAnB;QACAC;UACAC;UACAF;UACAO;YACAM;UACA;QACA;MACA,GAEA;QACAb;QACAC;UACAC;UACAF;UACAO;YACAM;UACA;QACA;MACA,GACA;QACAb;QACAC;UACAC;UACAF;UACAG;UACAC;YACAC;YACAC;YACAhB;UACA;UACAiB;YACAhB;YACAH;YACAoB;UACA;QACA;MACA,GACA;QACAR;QACAC;UACAC;UACAF;UACAG;UACAC;YACAC;YACAC;YACAhB;UACA;UACAiB;YACAhB;YACAH;YACAoB;UACA;QACA;MACA,EACA;MACA;MACA;QACA;UACAQ;UACA;QACA;MACA;MACA;MACA;MACA;QACA;QACA;QACA;UACA;QACA;MAEA;IACA;IACA;IACAI;MACA;MACA;MACA;MACA;QACA;QACAb;QACAA;MACA;MACA;IACA;IAEA;IACAc;MACA;MACA;MACA;QACA;QACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MAAA;MACA;MACAX;QACA;QACA;MACA;IACA;IACA;IACAY;MACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MACA/B;QACAmB;MACA;MACA;IACA;IACA;IACAa;MAAA;MACA;MACAhC;QACAiC;QACAC;QAAA;QACAhC;UAAA,2BACAiC;YACAnC;cACAoC;cACAlC;gBACAC;gBACAA;gBACA;kBACAgB;kBACAI;kBACAC;gBACA;gBACA;cACA;YACA;UAAA;UAbA;YAAA;UAcA;QACA;MACA;IACA;IACA;IACAa;MACA;MACA;QACA;QACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;IACA;IAEA;IACAC;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;QACA;MACA;MACA;MACA;QACAtB;MACA;MACA;MACA;IACA;IACA;IACAuB;MAAA;MACA;QAEAtC;QACAA;QACAA;QAEA;UACA;UACA;YACA;YACA;cACA;cACA;cACA;cACA,oFACA;cACAA;cACA;YACA;UACA;QACA;MACA;MACA;IACA;IAEA;IACAuC;MAAA;MACA;MACA;MACA;MACAtC;MACA;QACAC;QACAC;UACAC;UACAC;UACAH;UACAI;YACAC;YACAC;YACAhB;UACA;UACAiB;QACA;MACA;MACA;MACA;MACA;MACAK;QACAb;QACAA;QACAE;UACAD;UACAC;YACAC;YACAC;YACAH;YACAI;cACAC;cACAC;cACAhB;YACA;YACAiB;UACA;QACA;QACA;QACA;MACA;IACA;IAEA;IACA+B;MACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MACAvC;MACA;MACA;IACA;IACAwC;MACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MAAA;MACA;MACAjD;QACAkD;MACA;MACA/C;MACA;MACAc;QACA;QACA;UACA;YACAxB;YAAA;YACAC;YACAC;YACAC;YACAC;UACA;QACA;UACA;YACAJ;YAAA;YACAC;YACAC;YACAC;YACAC;UACA;UACA;YACA;YACA;cACAqB,uEACAP;YACA;YACAR;YACA;UACA;QACA;QACAH;QACA;MAEA;IAEA;IACA;IACAmD;MAAA;MACA;MACAlC;QACA;MACA;IACA;IACAmC;MACA;MACAhD;MACA;QACAC;QACAC;UACAC;UACAF;UACAO;QACA;MACA;MACA;IACA;IACA;IACAyC;MACArD;QACAmB;MACA;IACA;IACA;IACAmC;MACAtD;QACAuD;QACAC;QACAC;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;QACA;MACA;MACA;MACA;MACA;QACAC;MACA;IACA;IACA;IACAC;MAAA;MACA;MACA;MACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;QACA;MACA;MACA;MACA;MACA;QACA;QACA;MACA;QACA;QACA;MACA;IACA;IACA;IACAC;MACA;QACA;MACA;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MACAC;MACA;QACA/D;QACA;UACAiB;UACAD;QACA;QACA;QACA;QACAgD;QACAC;QACA9D;QACA;MACA;QACAH;MACA;MACA;IACA;IACA;IACAkE;MACA;MACA;IACA;IACAC;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC9zCA;AAAA;AAAA;AAAA;AAA4jD,CAAgB,i6CAAG,EAAC,C;;;;;;;;;;;ACAhlD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"tn_components/chat/chat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './tn_components/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=67b9dffd&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"tn_components/chat/chat.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=67b9dffd&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.msgList, function (row, index) {\n    var $orig = _vm.__get_orig(row)\n    var g0 =\n      row.type == \"user\" &&\n      row.msg.userinfo.uid == _vm.myuid &&\n      row.msg.type == \"voice\"\n        ? row.msg.content.length\n        : null\n    var g1 =\n      row.type == \"user\" &&\n      row.msg.userinfo.uid != _vm.myuid &&\n      row.msg.type == \"voice\"\n        ? row.msg.content.length\n        : null\n    return {\n      $orig: $orig,\n      g0: g0,\n      g1: g1,\n    }\n  })\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"content\" @touchstart=\"hideDrawer\">\r\n\t\t\t<scroll-view class=\"msg-list\" :class=\"popupLayerClass\" scroll-y=\"true\"\r\n\t\t\t\t:scroll-with-animation=\"scrollAnimation\" :scroll-top=\"scrollTop\" :scroll-into-view=\"scrollToView\"\r\n\t\t\t\t@scrolltoupper=\"loadHistory\" upper-threshold=\"50\">\r\n\t\t\t\t<!-- 加载历史数据waitingUI -->\r\n\t\t\t\t<view class=\"loading\">\r\n\t\t\t\t\t<view class=\"spinner\">\r\n\t\t\t\t\t\t<view class=\"rect1\"></view>\r\n\t\t\t\t\t\t<view class=\"rect2\"></view>\r\n\t\t\t\t\t\t<view class=\"rect3\"></view>\r\n\t\t\t\t\t\t<view class=\"rect4\"></view>\r\n\t\t\t\t\t\t<view class=\"rect5\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"row\" v-for=\"(row,index) in msgList\" :key=\"index\" :id=\"'msg'+row.msg.id\">\r\n\t\t\t\t\t<!-- 系统消息 -->\r\n\t\t\t\t\t<block v-if=\"row.type=='system'\">\r\n\t\t\t\t\t\t<view class=\"system\">\r\n\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='text'\" class=\"text\">\r\n\t\t\t\t\t\t\t\t{{row.msg.content.text}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 领取红包消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='redEnvelope'\" class=\"red-envelope\">\r\n\t\t\t\t\t\t\t\t<image src=\"/static/chat/red-envelope-chat.png\"></image>\r\n\t\t\t\t\t\t\t\t{{row.msg.content.text}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t\t<!-- 用户消息 -->\r\n\t\t\t\t\t<block v-if=\"row.type=='user'\">\r\n\t\t\t\t\t\t<!-- 自己发出的消息 -->\r\n\t\t\t\t\t\t<view class=\"my\" v-if=\"row.msg.userinfo.uid==myuid\">\r\n\t\t\t\t\t\t\t<!-- 左-消息 -->\r\n\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='text'\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.msg.content.text\"></rich-text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 语言消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='voice'\" class=\"bubble voice\" @tap=\"playVoice(row.msg)\"\r\n\t\t\t\t\t\t\t\t\t:class=\"playMsgid == row.msg.id?'play':''\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"length\">{{row.msg.content.length}}</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"icon my-voice\"></view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='img'\" class=\"bubble img\" @tap=\"showPic(row.msg)\">\r\n\t\t\t\t\t\t\t\t\t<image :src=\"row.msg.content.url\"\r\n\t\t\t\t\t\t\t\t\t\t:style=\"{'width': row.msg.content.w+'px','height': row.msg.content.h+'px'}\">\r\n\t\t\t\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 红包 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='redEnvelope'\" class=\"bubble red-envelope\"\r\n\t\t\t\t\t\t\t\t\t@tap=\"openRedEnvelope(row.msg,index)\">\r\n\t\t\t\t\t\t\t\t\t<image src=\"/static/chat/red-envelope.png\"></image>\r\n\t\t\t\t\t\t\t\t\t<view class=\"tis\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- 点击开红包 -->\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"blessing\">\r\n\t\t\t\t\t\t\t\t\t\t{{row.msg.content.blessing}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 右-头像 -->\r\n\t\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t\t<image :src=\"row.msg.userinfo.face\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- 别人发出的消息 -->\r\n\t\t\t\t\t\t<view class=\"other\" v-if=\"row.msg.userinfo.uid!=myuid\">\r\n\t\t\t\t\t\t\t<!-- 左-头像 -->\r\n\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t<image :src=\"row.msg.userinfo.face\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 右-用户名称-时间-消息 -->\r\n\t\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t\t<view class=\"username\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"name\">{{row.msg.userinfo.username}}</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"time\">{{row.msg.time}}</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='text'\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.msg.content.text\"></rich-text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 语音消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='voice'\" class=\"bubble voice\" @tap=\"playVoice(row.msg)\"\r\n\t\t\t\t\t\t\t\t\t:class=\"playMsgid == row.msg.id?'play':''\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"icon other-voice\"></view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"length\">{{row.msg.content.length}}</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='img'\" class=\"bubble img\" @tap=\"showPic(row.msg)\">\r\n\t\t\t\t\t\t\t\t\t<image :src=\"row.msg.content.url\"\r\n\t\t\t\t\t\t\t\t\t\t:style=\"{'width': row.msg.content.w+'px','height': row.msg.content.h+'px'}\">\r\n\t\t\t\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 红包 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.msg.type=='redEnvelope'\" class=\"bubble red-envelope\"\r\n\t\t\t\t\t\t\t\t\t@tap=\"openRedEnvelope(row.msg,index)\">\r\n\t\t\t\t\t\t\t\t\t<image src=\"/static/chat/red-envelope.png\"></image>\r\n\t\t\t\t\t\t\t\t\t<view class=\"tis\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- 点击开红包 -->\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"blessing\">\r\n\t\t\t\t\t\t\t\t\t\t{{row.msg.content.blessing}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\t\t<!-- 抽屉栏 -->\r\n\t\t<view class=\"popup-layer\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- 表情 -->\r\n\t\t\t<swiper class=\"emoji-swiper\" :class=\"{hidden:hideEmoji}\" indicator-dots=\"true\" duration=\"150\">\r\n\t\t\t\t<swiper-item v-for=\"(page,pid) in emojiList\" :key=\"pid\">\r\n\t\t\t\t\t<view v-for=\"(em,eid) in page\" :key=\"eid\" @tap=\"addEmoji(em)\">\r\n\t\t\t\t\t\t<!-- https://zhoukaiwen.com/img/icon/emojj1/1.png -->\r\n\t\t\t\t\t\t<image mode=\"widthFix\" :src=\"'https://zhoukaiwen.com/img/icon/emojj1/'+em.url\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</swiper-item>\r\n\t\t\t</swiper>\r\n\t\t\t<!-- 更多功能 相册-拍照-红包 -->\r\n\t\t\t<view class=\"more-layer\" :class=\"{hidden:hideMore}\">\r\n\t\t\t\t<view class=\"list\">\r\n\t\t\t\t\t<view class=\"box\" @tap=\"chooseImage\">\r\n\t\t\t\t\t\t<view class=\"icon tupian2\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"box\" @tap=\"camera\">\r\n\t\t\t\t\t\t<view class=\"icon paizhao\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"box\" @tap=\"handRedEnvelopes\">\r\n\t\t\t\t\t\t<view class=\"icon hongbao\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 底部输入栏 -->\r\n\t\t<view class=\"input-box cu-bar tabbar\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- H5下不能录音，输入栏布局改动一下 -->\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"voice\">\r\n\t\t\t\t<view class=\"icon\" :class=\"isVoice?'jianpan':'yuyin'\" @tap=\"switchVoice\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<!-- #ifdef H5 -->\r\n\t\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"textbox\">\r\n\t\t\t\t<view class=\"voice-mode\" :class=\"[isVoice?'':'hidden',recording?'recording':'']\"\r\n\t\t\t\t\t@touchstart=\"voiceBegin\" @touchmove.stop.prevent=\"voiceIng\" @touchend=\"voiceEnd\"\r\n\t\t\t\t\t@touchcancel=\"voiceCancel\">{{voiceTis}}</view>\r\n\t\t\t\t<view class=\"text-mode\" :class=\"isVoice?'hidden':''\">\r\n\t\t\t\t\t<view class=\"box\">\r\n\t\t\t\t\t\t<textarea auto-height=\"true\" v-model=\"textMsg\" @focus=\"textareaFocus\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"em\" @tap=\"chooseEmoji\">\r\n\t\t\t\t\t\t<view class=\"icon biaoqing\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"send\" :class=\"isVoice?'hidden':''\" @tap=\"sendText\">\r\n\t\t\t\t<view class=\"btn\">发送</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 录音UI效果 -->\r\n\t\t<view class=\"record\" :class=\"recording?'':'hidden'\">\r\n\t\t\t<view class=\"ing\" :class=\"willStop?'hidden':''\">\r\n\t\t\t\t<view class=\"icon luyin2\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"cancel\" :class=\"willStop?'':'hidden'\">\r\n\t\t\t\t<view class=\"icon chehui\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"tis\" :class=\"willStop?'change':''\">{{recordTis}}</view>\r\n\t\t</view>\r\n\t\t<!-- 红包弹窗 -->\r\n\t\t<view class=\"windows\" :class=\"windowsState\">\r\n\t\t\t<!-- 遮罩层 -->\r\n\t\t\t<view class=\"mask\" @touchmove.stop.prevent=\"discard\" @tap=\"closeRedEnvelope\"></view>\r\n\t\t\t<view class=\"layer\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t\t<view class=\"open-redenvelope\">\r\n\t\t\t\t\t<view class=\"top\">\r\n\t\t\t\t\t\t<view class=\"close-btn\">\r\n\t\t\t\t\t\t\t<view class=\"icon close\" @tap=\"closeRedEnvelope\"></view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<image src=\"https://zhoukaiwen.com/img/qdpz/face/face_1.jpg\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"from\">来自{{redenvelopeData.from}}</view>\r\n\t\t\t\t\t<view class=\"blessing\">{{redenvelopeData.blessing}}</view>\r\n\t\t\t\t\t<view class=\"money\">{{redenvelopeData.money}}</view>\r\n\t\t\t\t\t<view class=\"showDetails\" @tap=\"toDetails(redenvelopeData.rid)\">\r\n\t\t\t\t\t\t查看领取详情 <view class=\"icon to\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script>\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t//文字消息\r\n\t\t\t\ttextMsg: '',\r\n\t\t\t\t//消息列表\r\n\t\t\t\tisHistoryLoading: false,\r\n\t\t\t\tscrollAnimation: false,\r\n\t\t\t\tscrollTop: 0,\r\n\t\t\t\tscrollToView: '',\r\n\t\t\t\tmsgList: [],\r\n\t\t\t\tmsgImgList: [],\r\n\t\t\t\tmyuid: 0,\r\n\r\n\t\t\t\t//录音相关参数\r\n\t\t\t\t// #ifndef H5\r\n\t\t\t\t//H5不能录音\r\n\t\t\t\tRECORDER: uni.getRecorderManager(),\r\n\t\t\t\t// #endif\r\n\t\t\t\tisVoice: false,\r\n\t\t\t\tvoiceTis: '按住 说话',\r\n\t\t\t\trecordTis: \"手指上滑 取消发送\",\r\n\t\t\t\trecording: false,\r\n\t\t\t\twillStop: false,\r\n\t\t\t\tinitPoint: {\r\n\t\t\t\t\tidentifier: 0,\r\n\t\t\t\t\tY: 0\r\n\t\t\t\t},\r\n\t\t\t\trecordTimer: null,\r\n\t\t\t\trecordLength: 0,\r\n\r\n\t\t\t\t//播放语音相关参数\r\n\t\t\t\tAUDIO: uni.createInnerAudioContext(),\r\n\t\t\t\tplayMsgid: null,\r\n\t\t\t\tVoiceTimer: null,\r\n\t\t\t\t// 抽屉参数\r\n\t\t\t\tpopupLayerClass: '',\r\n\t\t\t\t// more参数\r\n\t\t\t\thideMore: true,\r\n\t\t\t\t//表情定义\r\n\t\t\t\thideEmoji: true,\r\n\t\t\t\temojiList: [\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\t\"url\": \"1.png\",\r\n\t\t\t\t\t\talt: \"[微笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"2.png\",\r\n\t\t\t\t\t\talt: \"[生气]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"3.png\",\r\n\t\t\t\t\t\talt: \"[坏笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"4.png\",\r\n\t\t\t\t\t\talt: \"[难受]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"5.png\",\r\n\t\t\t\t\t\talt: \"[困]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"6.png\",\r\n\t\t\t\t\t\talt: \"[偷看]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"7.png\",\r\n\t\t\t\t\t\talt: \"[难过]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"8.png\",\r\n\t\t\t\t\t\talt: \"[斜眼]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"9.png\",\r\n\t\t\t\t\t\talt: \"[委屈]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"10.png\",\r\n\t\t\t\t\t\talt: \"[害羞]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"11.png\",\r\n\t\t\t\t\t\talt: \"[裂开]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"12.png\",\r\n\t\t\t\t\t\talt: \"[偷笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"13.png\",\r\n\t\t\t\t\t\talt: \"[痛苦]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"14.png\",\r\n\t\t\t\t\t\talt: \"[白眼]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"15.png\",\r\n\t\t\t\t\t\talt: \"[丑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"16.png\",\r\n\t\t\t\t\t\talt: \"[哇哇哭]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"17.png\",\r\n\t\t\t\t\t\talt: \"[笑嘻嘻]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"18.png\",\r\n\t\t\t\t\t\talt: \"[盯着你]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"19.png\",\r\n\t\t\t\t\t\talt: \"[啊哈]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"20.png\",\r\n\t\t\t\t\t\talt: \"[吃瓜]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"21.png\",\r\n\t\t\t\t\t\talt: \"[哦吼]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"22.png\",\r\n\t\t\t\t\t\talt: \"[哭死]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"23.png\",\r\n\t\t\t\t\t\talt: \"[打脸]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"24.png\",\r\n\t\t\t\t\t\talt: \"[斗鸡眼]\"\r\n\t\t\t\t\t}],\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\t\"url\": \"25.png\",\r\n\t\t\t\t\t\talt: \"[发呆]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"26.png\",\r\n\t\t\t\t\t\talt: \"[憨笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"27.png\",\r\n\t\t\t\t\t\talt: \"[无语]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"28.png\",\r\n\t\t\t\t\t\talt: \"[鸡贼]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"29.png\",\r\n\t\t\t\t\t\talt: \"[大无语]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"30.png\",\r\n\t\t\t\t\t\talt: \"[哭吐了]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"31.png\",\r\n\t\t\t\t\t\talt: \"[呲牙笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"32.png\",\r\n\t\t\t\t\t\talt: \"[奸笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"33.png\",\r\n\t\t\t\t\t\talt: \"[啊啊啊]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"34.png\",\r\n\t\t\t\t\t\talt: \"[哈嘿]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"35.png\",\r\n\t\t\t\t\t\talt: \"[惊讶]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"36.png\",\r\n\t\t\t\t\t\talt: \"[指你]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"37.png\",\r\n\t\t\t\t\t\talt: \"[可爱型]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"38.png\",\r\n\t\t\t\t\t\talt: \"[快哭了]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"39.png\",\r\n\t\t\t\t\t\talt: \"[抠鼻屎]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"40.png\",\r\n\t\t\t\t\t\talt: \"[酷酷]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"41.png\",\r\n\t\t\t\t\t\talt: \"[笑汗]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"42.png\",\r\n\t\t\t\t\t\talt: \"[算命]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"43.png\",\r\n\t\t\t\t\t\talt: \"[红脸坏笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"44.png\",\r\n\t\t\t\t\t\talt: \"[委屈死了]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"45.png\",\r\n\t\t\t\t\t\talt: \"[爆炸]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"46.png\",\r\n\t\t\t\t\t\talt: \"[吐了]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"47.png\",\r\n\t\t\t\t\t\talt: \"[么么哒]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"48.png\",\r\n\t\t\t\t\t\talt: \"[吐血]\"\r\n\t\t\t\t\t}],\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\t\"url\": \"49.png\",\r\n\t\t\t\t\t\talt: \"[面无表情]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"50.png\",\r\n\t\t\t\t\t\talt: \"[捂嘴吐]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"51.png\",\r\n\t\t\t\t\t\talt: \"[斜眼看]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"52.png\",\r\n\t\t\t\t\t\talt: \"[花痴]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"53.png\",\r\n\t\t\t\t\t\talt: \"[被打]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"54.png\",\r\n\t\t\t\t\t\talt: \"[瞌睡]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"55.png\",\r\n\t\t\t\t\t\talt: \"[冥想]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"56.png\",\r\n\t\t\t\t\t\talt: \"[俏皮]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"57.png\",\r\n\t\t\t\t\t\talt: \"[戳手委屈]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"58.png\",\r\n\t\t\t\t\t\talt: \"[端庄]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"59.png\",\r\n\t\t\t\t\t\talt: \"[emmm]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"60.png\",\r\n\t\t\t\t\t\talt: \"[欢呼]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"61.png\",\r\n\t\t\t\t\t\talt: \"[笑哭了]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"62.png\",\r\n\t\t\t\t\t\talt: \"[抱抱]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"63.png\",\r\n\t\t\t\t\t\talt: \"[闭眼笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"64.png\",\r\n\t\t\t\t\t\talt: \"[捂嘴微笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"65.png\",\r\n\t\t\t\t\t\talt: \"[笑哭2]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"66.png\",\r\n\t\t\t\t\t\talt: \"[笑嘻嘻]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"67.png\",\r\n\t\t\t\t\t\talt: \"[笑露齿]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"68.png\",\r\n\t\t\t\t\t\talt: \"[阴脸笑]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"69.png\",\r\n\t\t\t\t\t\talt: \"[问号脸]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"70.png\",\r\n\t\t\t\t\t\talt: \"[拜拜]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"71.png\",\r\n\t\t\t\t\t\talt: \"[难受2]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"72.png\",\r\n\t\t\t\t\t\talt: \"[傻笑2]\"\r\n\t\t\t\t\t}],\r\n\t\t\t\t\t[{\r\n\t\t\t\t\t\t\"url\": \"73.png\",\r\n\t\t\t\t\t\talt: \"[爆炸2]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"74.png\",\r\n\t\t\t\t\t\talt: \"[二哈]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"75.png\",\r\n\t\t\t\t\t\talt: \"[二哈吐舌]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"76.png\",\r\n\t\t\t\t\t\talt: \"[狗狗笑哭]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"77.png\",\r\n\t\t\t\t\t\talt: \"[狗狗绿帽]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"78.png\",\r\n\t\t\t\t\t\talt: \"[狗狗张嘴]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"79.png\",\r\n\t\t\t\t\t\talt: \"[狗狗绿扇]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"80.png\",\r\n\t\t\t\t\t\talt: \"[狗狗]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"81.png\",\r\n\t\t\t\t\t\talt: \"[猫咪]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"82.png\",\r\n\t\t\t\t\t\talt: \"[牛啊]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"83.png\",\r\n\t\t\t\t\t\talt: \"[爱心]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"84.png\",\r\n\t\t\t\t\t\talt: \"[心裂开]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"85.png\",\r\n\t\t\t\t\t\talt: \"[玫瑰花]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"86.png\",\r\n\t\t\t\t\t\talt: \"[枯萎]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"87.png\",\r\n\t\t\t\t\t\talt: \"[棒]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"88.png\",\r\n\t\t\t\t\t\talt: \"[差]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"89.png\",\r\n\t\t\t\t\t\talt: \"[红药]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"90.png\",\r\n\t\t\t\t\t\talt: \"[绿药]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"91.png\",\r\n\t\t\t\t\t\talt: \"[抱拳]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"92.png\",\r\n\t\t\t\t\t\talt: \"[ok]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"93.png\",\r\n\t\t\t\t\t\talt: \"[pk]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"94.png\",\r\n\t\t\t\t\t\talt: \"[绿帽子]\"\r\n\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\"url\": \"95.png\",\r\n\t\t\t\t\t\talt: \"[菜刀]\"\r\n\t\t\t\t\t}]\r\n\t\t\t\t],\r\n\t\t\t\t//表情图片图床名称 ，由于我上传的第三方图床名称会有改变，所以有此数据来做对应，您实际应用中应该不需要\r\n\t\t\t\tonlineEmoji: {\r\n\t\t\t\t\t\"1.png\": \"1.png\",\"2.png\": \"2.png\",\"3.png\": \"3.png\",\"4.png\": \"4.png\",\"5.png\": \"5.png\",\"6.png\": \"6.png\",\r\n\t\t\t\t\t\"7.png\": \"7.png\",\"8.png\": \"8.png\",\"9.png\": \"9.png\",\"10.png\": \"10.png\",\"11.png\": \"11.png\",\"12.png\": \"12.png\",\n\t\t\t\t\t\n\t\t\t\t\t\"13.png\": \"13.png\",\"14.png\": \"14.png\",\"15.png\": \"15.png\",\"16.png\": \"16.png\",\"17.png\": \"17.png\",\"18.png\": \"18.png\",\r\n\t\t\t\t\t\"19.png\": \"19.png\",\"20.png\": \"20.png\",\"21.png\": \"21.png\",\"22.png\": \"22.png\",\"23.png\": \"23.png\",\"24.png\": \"24.png\",\n\t\t\t\t\t\r\n\t\t\t\t\t\"25.png\": \"25.png\",\"26.png\": \"26.png\",\"27.png\": \"27.png\",\"28.png\": \"28.png\",\"29.png\": \"29.png\",\"30.png\": \"30.png\",\r\n\t\t\t\t\t\"31.png\": \"31.png\",\"32.png\": \"32.png\",\"33.png\": \"33.png\",\"34.png\": \"34.png\",\"35.png\": \"35.png\",\"36.png\": \"36.png\",\n\t\t\t\t\t\r\n\t\t\t\t\t\"37.png\": \"37.png\",\"38.png\": \"38.png\",\"39.png\": \"39.png\",\"40.png\": \"40.png\",\"41.png\": \"41.png\",\"42.png\": \"42.png\",\r\n\t\t\t\t\t\"43.png\": \"43.png\",\"44.png\": \"44.png\",\"45.png\": \"45.png\",\"46.png\": \"46.png\",\"47.png\": \"47.png\",\"48.png\": \"48.png\",\n\t\t\t\t\t\r\n\t\t\t\t\t\"49.png\": \"49.png\",\"50.png\": \"50.png\",\"51.png\": \"51.png\",\"52.png\": \"52.png\",\"53.png\": \"53.png\",\"54.png\": \"54.png\",\r\n\t\t\t\t\t\"55.png\": \"55.png\",\"56.png\": \"56.png\",\"57.png\": \"57.png\",\"58.png\": \"58.png\",\"59.png\": \"59.png\",\"60.png\": \"60.png\",\n\t\t\t\t\t\r\n\t\t\t\t\t\"61.png\": \"61.png\",\"62.png\": \"62.png\",\"63.png\": \"63.png\",\"64.png\": \"64.png\",\"65.png\": \"65.png\",\"66.png\": \"66.png\",\r\n\t\t\t\t\t\"67.png\": \"67.png\",\"68.png\": \"68.png\",\"69.png\": \"69.png\",\"70.png\": \"70.png\",\"71.png\": \"71.png\",\"72.png\": \"72.png\",\n\t\t\t\t\t\r\n\t\t\t\t\t\"73.png\": \"73.png\",\"74.png\": \"74.png\",\"75.png\": \"75.png\",\"76.png\": \"76.png\",\"77.png\": \"77.png\",\"78.png\": \"78.png\",\r\n\t\t\t\t\t\"79.png\": \"79.png\",\"80.png\": \"80.png\",\"81.png\": \"81.png\",\"82.png\": \"82.png\",\"83.png\": \"83.png\",\"84.png\": \"84.png\",\n\t\t\t\t\t\r\n\t\t\t\t\t\"85.png\": \"85.png\",\"86.png\": \"86.png\",\"87.png\": \"87.png\",\"88.png\": \"88.png\",\"89.png\": \"89.png\",\"90.png\": \"90.png\",\r\n\t\t\t\t\t\"91.png\": \"91.png\",\"92.png\": \"92.png\",\"93.png\": \"93\",\"94.png\": \"94.png\",\"95.png\": \"95.png\"\r\n\t\t\t\t},\r\n\t\t\t\t//红包相关参数\r\n\t\t\t\twindowsState: '',\r\n\t\t\t\tredenvelopeData: {\r\n\t\t\t\t\trid: null, //红包ID\r\n\t\t\t\t\tfrom: null,\r\n\t\t\t\t\tface: null,\r\n\t\t\t\t\tblessing: null,\r\n\t\t\t\t\tmoney: null\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad(option) {\r\n\t\t\tthis.getMsgList();\r\n\t\t\t//语音自然播放结束\r\n\t\t\tthis.AUDIO.onEnded((res) => {\r\n\t\t\t\tthis.playMsgid = null;\r\n\t\t\t});\r\n\t\t\t// #ifndef H5\r\n\t\t\t//录音开始事件\r\n\t\t\tthis.RECORDER.onStart((e) => {\r\n\t\t\t\tthis.recordBegin(e);\r\n\t\t\t})\r\n\t\t\t//录音结束事件\r\n\t\t\tthis.RECORDER.onStop((e) => {\r\n\t\t\t\tthis.recordEnd(e);\r\n\t\t\t})\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tthis.scrollTop = 9999999;\r\n\r\n\t\t\t//模板借由本地缓存实现发红包效果，实际应用中请不要使用此方法。\r\n\t\t\t//\r\n\t\t\tuni.getStorage({\r\n\t\t\t\tkey: 'redEnvelopeData',\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tconsole.log(res.data);\r\n\t\t\t\t\tlet nowDate = new Date();\r\n\t\t\t\t\tlet lastid = this.msgList[this.msgList.length - 1].msg.id;\r\n\t\t\t\t\tlastid++;\r\n\t\t\t\t\tlet row = {\r\n\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: lastid,\r\n\t\t\t\t\t\t\ttype: \"redEnvelope\",\r\n\t\t\t\t\t\t\ttime: nowDate.getHours() + \":\" + nowDate.getMinutes(),\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 0,\r\n\t\t\t\t\t\t\t\tusername: \"大黑哥\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/kevinLogo.png\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\tblessing: res.data.blessing,\r\n\t\t\t\t\t\t\t\trid: Math.floor(Math.random() * 1000 + 1),\r\n\t\t\t\t\t\t\t\tisReceived: false\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.screenMsg(row);\r\n\t\t\t\t\tuni.removeStorage({\r\n\t\t\t\t\t\tkey: 'redEnvelopeData'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 接受消息(筛选处理)\r\n\t\t\tscreenMsg(msg) {\r\n\t\t\t\t//从长连接处转发给这个方法，进行筛选处理\r\n\t\t\t\tif (msg.type == 'system') {\r\n\t\t\t\t\t// 系统消息\r\n\t\t\t\t\tswitch (msg.msg.type) {\r\n\t\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\t\tthis.addSystemTextMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'redEnvelope':\r\n\t\t\t\t\t\t\tthis.addSystemRedEnvelopeMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (msg.type == 'user') {\r\n\t\t\t\t\t// 用户消息\r\n\t\t\t\t\tswitch (msg.msg.type) {\r\n\t\t\t\t\t\tcase 'text':\r\n\t\t\t\t\t\t\tthis.addTextMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'voice':\r\n\t\t\t\t\t\t\tthis.addVoiceMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'img':\r\n\t\t\t\t\t\t\tthis.addImgMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'redEnvelope':\r\n\t\t\t\t\t\t\tthis.addRedEnvelopeMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.log('用户消息');\r\n\t\t\t\t\t//非自己的消息震动\r\n\t\t\t\t\tif (msg.msg.userinfo.uid != this.myuid) {\r\n\t\t\t\t\t\tconsole.log('振动');\r\n\t\t\t\t\t\tuni.vibrateLong();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t// 滚动到底\r\n\t\t\t\t\tthis.scrollToView = 'msg' + msg.msg.id\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t//触发滑动到顶部(加载历史信息记录)\r\n\t\t\tloadHistory(e) {\r\n\t\t\t\tif (this.isHistoryLoading) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.isHistoryLoading = true; //参数作为进入请求标识，防止重复请求\r\n\t\t\t\tthis.scrollAnimation = false; //关闭滑动动画\r\n\t\t\t\tlet Viewid = this.msgList[0].msg.id; //记住第一个信息ID\r\n\t\t\t\t//本地模拟请求历史记录效果\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// 消息列表\r\n\t\t\t\t\tlet list = [{\r\n\t\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\t\tid: 1,\r\n\t\t\t\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\t\t\t\ttime: \"12:56\",\r\n\t\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\t\tuid: 0,\r\n\t\t\t\t\t\t\t\t\tusername: \"大黑哥\",\r\n\t\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/kevinLogo.png\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\t\ttext: \"web前端开发该怎么学习？\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\t\tid: 2,\r\n\t\t\t\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\t\t\t\ttime: \"12:57\",\r\n\t\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\t\tuid: 1,\r\n\t\t\t\t\t\t\t\t\tusername: \"售后客服008\",\r\n\t\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/qdpz/face/face_2.jpg\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\t\ttext: \"按照基本路线，从html、css、js三大基础开始，然后ajax、vue进阶学习，最后学习小程序、node、react。\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\t\tid: 3,\r\n\t\t\t\t\t\t\t\ttype: \"voice\",\r\n\t\t\t\t\t\t\t\ttime: \"12:59\",\r\n\t\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\t\tuid: 1,\r\n\t\t\t\t\t\t\t\t\tusername: \"售后客服008\",\r\n\t\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/qdpz/face/face_2.jpg\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\t\turl: \"/static/voice/1.mp3\",\r\n\t\t\t\t\t\t\t\t\tlength: \"00:06\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\t\tid: 4,\r\n\t\t\t\t\t\t\t\ttype: \"voice\",\r\n\t\t\t\t\t\t\t\ttime: \"13:05\",\r\n\t\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\t\tuid: 0,\r\n\t\t\t\t\t\t\t\t\tusername: \"大黑哥\",\r\n\t\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/kevinLogo.png\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\t\turl: \"/static/voice/2.mp3\",\r\n\t\t\t\t\t\t\t\t\tlength: \"00:06\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t]\r\n\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\tfor (let i = 0; i < list.length; i++) {\r\n\t\t\t\t\t\tif (list[i].type == 'user' && list[i].msg.type == \"img\") {\r\n\t\t\t\t\t\t\tlist[i].msg.content = this.setPicSize(list[i].msg.content);\r\n\t\t\t\t\t\t\tthis.msgImgList.unshift(list[i].msg.content.url);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlist[i].msg.id = Math.floor(Math.random() * 1000 + 1);\r\n\t\t\t\t\t\tthis.msgList.unshift(list[i]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//这段代码很重要，不然每次加载历史数据都会跳到顶部\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\tthis.scrollToView = 'msg' + Viewid; //跳转上次的第一行信息位置\r\n\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\tthis.scrollAnimation = true; //恢复滚动动画\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.isHistoryLoading = false;\r\n\r\n\t\t\t\t}, 1000)\r\n\t\t\t},\r\n\t\t\t// 加载初始页面消息\r\n\t\t\tgetMsgList() {\r\n\t\t\t\t// 消息列表\r\n\t\t\t\tlet list = [{\r\n\t\t\t\t\t\ttype: \"system\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 0,\r\n\t\t\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\ttext: \"欢迎进入Kevin聊天室\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 1,\r\n\t\t\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\t\t\ttime: \"12:56\",\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 0,\r\n\t\t\t\t\t\t\t\tusername: \"大黑哥\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/kevinLogo.png\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\ttext: \"web前端开发该怎么学习？\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 2,\r\n\t\t\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\t\t\ttime: \"12:57\",\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 1,\r\n\t\t\t\t\t\t\t\tusername: \"售后客服008\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/qdpz/face/face_2.jpg\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\ttext: \"按照基本路线，从html、css、js三大基础开始，然后ajax、vue进阶学习，最后学习小程序、node、react。\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 3,\r\n\t\t\t\t\t\t\ttype: \"voice\",\r\n\t\t\t\t\t\t\ttime: \"12:59\",\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 1,\r\n\t\t\t\t\t\t\t\tusername: \"售后客服008\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/qdpz/face/face_2.jpg\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\turl: \"/static/voice/1.mp3\",\r\n\t\t\t\t\t\t\t\tlength: \"00:06\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 4,\r\n\t\t\t\t\t\t\ttype: \"voice\",\r\n\t\t\t\t\t\t\ttime: \"13:05\",\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 0,\r\n\t\t\t\t\t\t\t\tusername: \"大黑哥\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/kevinLogo.png\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\turl: \"/static/voice/2.mp3\",\r\n\t\t\t\t\t\t\t\tlength: \"00:06\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 5,\r\n\t\t\t\t\t\t\ttype: \"img\",\r\n\t\t\t\t\t\t\ttime: \"13:05\",\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 0,\r\n\t\t\t\t\t\t\t\tusername: \"大黑哥\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/kevinLogo.png\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\turl: \"https://zhoukaiwen.com/img/Design/logo/psketch3.png\",\r\n\t\t\t\t\t\t\t\tw: 200,\r\n\t\t\t\t\t\t\t\th: 200\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 6,\r\n\t\t\t\t\t\t\ttype: \"img\",\r\n\t\t\t\t\t\t\ttime: \"12:59\",\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 1,\r\n\t\t\t\t\t\t\t\tusername: \"售后客服008\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/qdpz/face/face_2.jpg\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\turl: \"https://zhoukaiwen.com/img/Design/pc/ybss_jt.png\",\r\n\t\t\t\t\t\t\t\tw: 1920,\r\n\t\t\t\t\t\t\t\th: 1080\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"system\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 7,\r\n\t\t\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\ttext: \"欢迎进入Kevin聊天室\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"system\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 9,\r\n\t\t\t\t\t\t\ttype: \"redEnvelope\",\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\ttext: \"售后客服008领取了你的红包\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 10,\r\n\t\t\t\t\t\t\ttype: \"redEnvelope\",\r\n\t\t\t\t\t\t\ttime: \"12:56\",\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 0,\r\n\t\t\t\t\t\t\t\tusername: \"大黑哥\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/kevinLogo.png\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\tblessing: \"恭喜发财，大吉大利，万事如意\",\r\n\t\t\t\t\t\t\t\trid: 0,\r\n\t\t\t\t\t\t\t\tisReceived: false\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"user\",\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: 11,\r\n\t\t\t\t\t\t\ttype: \"redEnvelope\",\r\n\t\t\t\t\t\t\ttime: \"12:56\",\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 1,\r\n\t\t\t\t\t\t\t\tusername: \"售后客服008\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/qdpz/face/face_2.jpg\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\t\tblessing: \"恭喜发财\",\r\n\t\t\t\t\t\t\t\trid: 1,\r\n\t\t\t\t\t\t\t\tisReceived: false\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t]\r\n\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\tfor (let i = 0; i < list.length; i++) {\r\n\t\t\t\t\tif (list[i].type == 'user' && list[i].msg.type == \"img\") {\r\n\t\t\t\t\t\tlist[i].msg.content = this.setPicSize(list[i].msg.content);\r\n\t\t\t\t\t\tthis.msgImgList.push(list[i].msg.content.url);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.msgList = list;\r\n\t\t\t\t// 滚动到底部\r\n\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\tthis.scrollTop = 9999;\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//处理图片尺寸，如果不处理宽高，新进入页面加载图片时候会闪\r\n\t\t\tsetPicSize(content) {\r\n\t\t\t\t// 让图片最长边等于设置的最大长度，短边等比例缩小，图片控件真实改变，区别于aspectFit方式。\r\n\t\t\t\tlet maxW = uni.upx2px(350); //350是定义消息图片最大宽度\r\n\t\t\t\tlet maxH = uni.upx2px(350); //350是定义消息图片最大高度\r\n\t\t\t\tif (content.w > maxW || content.h > maxH) {\r\n\t\t\t\t\tlet scale = content.w / content.h;\r\n\t\t\t\t\tcontent.w = scale > 1 ? maxW : maxH * scale;\r\n\t\t\t\t\tcontent.h = scale > 1 ? maxW / scale : maxH;\r\n\t\t\t\t}\r\n\t\t\t\treturn content;\r\n\t\t\t},\r\n\r\n\t\t\t//更多功能(点击+弹出) \r\n\t\t\tshowMore() {\r\n\t\t\t\tthis.isVoice = false;\r\n\t\t\t\tthis.hideEmoji = true;\r\n\t\t\t\tif (this.hideMore) {\r\n\t\t\t\t\tthis.hideMore = false;\r\n\t\t\t\t\tthis.openDrawer();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 打开抽屉\r\n\t\t\topenDrawer() {\r\n\t\t\t\tthis.popupLayerClass = 'showLayer';\r\n\t\t\t},\r\n\t\t\t// 隐藏抽屉\r\n\t\t\thideDrawer() {\r\n\t\t\t\tthis.popupLayerClass = '';\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.hideMore = true;\r\n\t\t\t\t\tthis.hideEmoji = true;\r\n\t\t\t\t}, 150);\r\n\t\t\t},\r\n\t\t\t// 选择图片发送\r\n\t\t\tchooseImage() {\r\n\t\t\t\tthis.getImage('album');\r\n\t\t\t},\r\n\t\t\t//拍照发送\r\n\t\t\tcamera() {\r\n\t\t\t\tthis.getImage('camera');\r\n\t\t\t},\r\n\t\t\t//发红包\r\n\t\t\thandRedEnvelopes() {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: 'hand/hand'\r\n\t\t\t\t});\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t},\r\n\t\t\t//选照片 or 拍照\r\n\t\t\tgetImage(type) {\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tsourceType: [type],\r\n\t\t\t\t\tsizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tfor (let i = 0; i < res.tempFilePaths.length; i++) {\r\n\t\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\t\tsrc: res.tempFilePaths[i],\r\n\t\t\t\t\t\t\t\tsuccess: (image) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log(image.width);\r\n\t\t\t\t\t\t\t\t\tconsole.log(image.height);\r\n\t\t\t\t\t\t\t\t\tlet msg = {\r\n\t\t\t\t\t\t\t\t\t\turl: res.tempFilePaths[i],\r\n\t\t\t\t\t\t\t\t\t\tw: image.width,\r\n\t\t\t\t\t\t\t\t\t\th: image.height\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\tthis.sendMsg(msg, 'img');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 选择表情\r\n\t\t\tchooseEmoji() {\r\n\t\t\t\tthis.hideMore = true;\r\n\t\t\t\tif (this.hideEmoji) {\r\n\t\t\t\t\tthis.hideEmoji = false;\r\n\t\t\t\t\tthis.openDrawer();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//添加表情\r\n\t\t\taddEmoji(em) {\r\n\t\t\t\tthis.textMsg += em.alt;\r\n\t\t\t},\r\n\r\n\t\t\t//获取焦点，如果不是选表情ing,则关闭抽屉\r\n\t\t\ttextareaFocus() {\r\n\t\t\t\tif (this.popupLayerClass == 'showLayer' && this.hideMore == false) {\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 发送文字消息\r\n\t\t\tsendText() {\r\n\t\t\t\tthis.hideDrawer(); //隐藏抽屉\r\n\t\t\t\tif (!this.textMsg) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet content = this.replaceEmoji(this.textMsg);\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\ttext: content\r\n\t\t\t\t}\r\n\t\t\t\tthis.sendMsg(msg, 'text');\r\n\t\t\t\tthis.textMsg = ''; //清空输入框\r\n\t\t\t},\r\n\t\t\t//替换表情符号为图片\r\n\t\t\treplaceEmoji(str) {\r\n\t\t\t\tlet replacedStr = str.replace(/\\[([^(\\]|\\[)]*)\\]/g, (item, index) => {\n\t\t\t\t\t\r\n\t\t\t\t\tconsole.log(\"str: \" + str);\r\n\t\t\t\t\tconsole.log(\"index: \" + index);\r\n\t\t\t\t\tconsole.log(\"item: \" + item);\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i = 0; i < this.emojiList.length; i++) {\r\n\t\t\t\t\t\tlet row = this.emojiList[i];\r\n\t\t\t\t\t\tfor (let j = 0; j < row.length; j++) {\r\n\t\t\t\t\t\t\tlet EM = row[j];\r\n\t\t\t\t\t\t\tif (EM.alt == item) {\r\n\t\t\t\t\t\t\t\t//在线表情路径，图文混排必须使用网络路径，请上传一份表情到你的服务器后再替换此路径 \r\n\t\t\t\t\t\t\t\t//比如你上传服务器后，你的100.gif路径为https://www.xxx.com/emoji/100.gif 则替换onlinePath填写为https://www.xxx.com/emoji/\r\n\t\t\t\t\t\t\t\tlet onlinePath = 'https://zhoukaiwen.com/img/icon/emojj1/'\r\n\t\t\t\t\t\t\t\tlet imgstr = '<img width=\"32rpx\" src=\"' + onlinePath + this.onlineEmoji[EM.url] +\r\n\t\t\t\t\t\t\t\t\t'\">';\r\n\t\t\t\t\t\t\t\tconsole.log(\"imgstr: \" + imgstr);\r\n\t\t\t\t\t\t\t\treturn imgstr;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn '<div style=\"display: flex;align-items: center;word-wrap:break-word;\">' + replacedStr + '</div>';\r\n\t\t\t},\r\n\r\n\t\t\t// 发送消息\r\n\t\t\tsendMsg(content, type) {\r\n\t\t\t\t//实际应用中，此处应该提交长连接，模板仅做本地处理。\r\n\t\t\t\tvar nowDate = new Date();\r\n\t\t\t\tlet lastid = this.msgList[this.msgList.length - 1].msg.id;\r\n\t\t\t\tlastid++;\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\ttype: 'user',\r\n\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\tid: lastid,\r\n\t\t\t\t\t\ttime: nowDate.getHours() + \":\" + nowDate.getMinutes(),\r\n\t\t\t\t\t\ttype: type,\r\n\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\tuid: 0,\r\n\t\t\t\t\t\t\tusername: \"大黑哥\",\r\n\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/kevinLogo.png\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcontent: content\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 发送消息\r\n\t\t\t\tthis.screenMsg(msg);\r\n\t\t\t\t// 定时器模拟对方回复,三秒\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tlastid = this.msgList[this.msgList.length - 1].msg.id;\r\n\t\t\t\t\tlastid++;\r\n\t\t\t\t\tmsg = {\r\n\t\t\t\t\t\ttype: 'user',\r\n\t\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\t\tid: lastid,\r\n\t\t\t\t\t\t\ttime: nowDate.getHours() + \":\" + nowDate.getMinutes(),\r\n\t\t\t\t\t\t\ttype: type,\r\n\t\t\t\t\t\t\tuserinfo: {\r\n\t\t\t\t\t\t\t\tuid: 1,\r\n\t\t\t\t\t\t\t\tusername: \"售后客服008\",\r\n\t\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/qdpz/face/face_2.jpg\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcontent: content\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 本地模拟发送消息\r\n\t\t\t\t\tthis.screenMsg(msg);\r\n\t\t\t\t}, 3000)\r\n\t\t\t},\r\n\r\n\t\t\t// 添加文字消息到列表\r\n\t\t\taddTextMsg(msg) {\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加语音消息到列表\r\n\t\t\taddVoiceMsg(msg) {\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加图片消息到列表\r\n\t\t\taddImgMsg(msg) {\r\n\t\t\t\tmsg.msg.content = this.setPicSize(msg.msg.content);\r\n\t\t\t\tthis.msgImgList.push(msg.msg.content.url);\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\taddRedEnvelopeMsg(msg) {\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加系统文字消息到列表\r\n\t\t\taddSystemTextMsg(msg) {\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加系统红包消息到列表\r\n\t\t\taddSystemRedEnvelopeMsg(msg) {\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 打开红包\r\n\t\t\topenRedEnvelope(msg, index) {\r\n\t\t\t\tlet rid = msg.content.rid;\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '加载中...'\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log(\"index: \" + index);\r\n\t\t\t\t//模拟请求服务器效果\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t//加载数据\r\n\t\t\t\t\tif (rid == 0) {\r\n\t\t\t\t\t\tthis.redenvelopeData = {\r\n\t\t\t\t\t\t\trid: 0, //红包ID\r\n\t\t\t\t\t\t\tfrom: \"大黑哥\",\r\n\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/qdpz/face/face.jpg\",\r\n\t\t\t\t\t\t\tblessing: \"恭喜发财，大吉大利\",\r\n\t\t\t\t\t\t\tmoney: \"已领完\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.redenvelopeData = {\r\n\t\t\t\t\t\t\trid: 1, //红包ID\r\n\t\t\t\t\t\t\tfrom: \"售后客服008\",\r\n\t\t\t\t\t\t\tface: \"https://zhoukaiwen.com/img/qdpz/face/face_2.jpg\",\r\n\t\t\t\t\t\t\tblessing: \"恭喜发财\",\r\n\t\t\t\t\t\t\tmoney: \"0.01\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!msg.content.isReceived) {\r\n\t\t\t\t\t\t\t// {type:\"system\",msg:{id:8,type:\"redEnvelope\",content:{text:\"你领取了售后客服008的红包\"}}},\r\n\t\t\t\t\t\t\tthis.sendSystemMsg({\r\n\t\t\t\t\t\t\t\ttext: \"你领取了\" + (msg.userinfo.uid == this.myuid ? \"自己\" : msg.userinfo\r\n\t\t\t\t\t\t\t\t\t.username) + \"的红包\"\r\n\t\t\t\t\t\t\t}, 'redEnvelope');\r\n\t\t\t\t\t\t\tconsole.log(\"this.msgList[index]: \" + JSON.stringify(this.msgList[index]));\r\n\t\t\t\t\t\t\tthis.msgList[index].msg.content.isReceived = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tthis.windowsState = 'show';\r\n\r\n\t\t\t\t}, 200)\r\n\r\n\t\t\t},\r\n\t\t\t// 关闭红包弹窗\r\n\t\t\tcloseRedEnvelope() {\r\n\t\t\t\tthis.windowsState = 'hide';\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.windowsState = '';\r\n\t\t\t\t}, 200)\r\n\t\t\t},\r\n\t\t\tsendSystemMsg(content, type) {\r\n\t\t\t\tlet lastid = this.msgList[this.msgList.length - 1].msg.id;\r\n\t\t\t\tlastid++;\r\n\t\t\t\tlet row = {\r\n\t\t\t\t\ttype: \"system\",\r\n\t\t\t\t\tmsg: {\r\n\t\t\t\t\t\tid: lastid,\r\n\t\t\t\t\t\ttype: type,\r\n\t\t\t\t\t\tcontent: content\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tthis.screenMsg(row)\r\n\t\t\t},\r\n\t\t\t//领取详情\r\n\t\t\ttoDetails(rid) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: 'details/details?rid=' + rid\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 预览图片\r\n\t\t\tshowPic(msg) {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tindicator: \"none\",\r\n\t\t\t\t\tcurrent: msg.content.url,\r\n\t\t\t\t\turls: this.msgImgList\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 播放语音\r\n\t\t\tplayVoice(msg) {\r\n\t\t\t\tthis.playMsgid = msg.id;\r\n\t\t\t\tthis.AUDIO.src = msg.content.url;\r\n\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\tthis.AUDIO.play();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 录音开始\r\n\t\t\tvoiceBegin(e) {\r\n\t\t\t\tif (e.touches.length > 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.initPoint.Y = e.touches[0].clientY;\r\n\t\t\t\tthis.initPoint.identifier = e.touches[0].identifier;\r\n\t\t\t\tthis.RECORDER.start({\r\n\t\t\t\t\tformat: \"mp3\"\r\n\t\t\t\t}); //录音开始,\r\n\t\t\t},\r\n\t\t\t//录音开始UI效果\r\n\t\t\trecordBegin(e) {\r\n\t\t\t\tthis.recording = true;\r\n\t\t\t\tthis.voiceTis = '松开 结束';\r\n\t\t\t\tthis.recordLength = 0;\r\n\t\t\t\tthis.recordTimer = setInterval(() => {\r\n\t\t\t\t\tthis.recordLength++;\r\n\t\t\t\t}, 1000)\r\n\t\t\t},\r\n\t\t\t// 录音被打断\r\n\t\t\tvoiceCancel() {\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis = '按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.willStop = true; //不发送录音\r\n\t\t\t\tthis.RECORDER.stop(); //录音结束\r\n\t\t\t},\r\n\t\t\t// 录音中(判断是否触发上滑取消发送)\r\n\t\t\tvoiceIng(e) {\r\n\t\t\t\tif (!this.recording) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet touche = e.touches[0];\r\n\t\t\t\t//上滑一个导航栏的高度触发上滑取消发送\r\n\t\t\t\tif (this.initPoint.Y - touche.clientY >= uni.upx2px(100)) {\r\n\t\t\t\t\tthis.willStop = true;\r\n\t\t\t\t\tthis.recordTis = '松开手指 取消发送'\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.willStop = false;\r\n\t\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 结束录音\r\n\t\t\tvoiceEnd(e) {\r\n\t\t\t\tif (!this.recording) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis = '按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.RECORDER.stop(); //录音结束\r\n\t\t\t},\r\n\t\t\t//录音结束(回调文件)\r\n\t\t\trecordEnd(e) {\r\n\t\t\t\tclearInterval(this.recordTimer);\r\n\t\t\t\tif (!this.willStop) {\r\n\t\t\t\t\tconsole.log(\"e: \" + JSON.stringify(e));\r\n\t\t\t\t\tlet msg = {\r\n\t\t\t\t\t\tlength: 0,\r\n\t\t\t\t\t\turl: e.tempFilePath\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet min = parseInt(this.recordLength / 60);\r\n\t\t\t\t\tlet sec = this.recordLength % 60;\r\n\t\t\t\t\tmin = min < 10 ? '0' + min : min;\r\n\t\t\t\t\tsec = sec < 10 ? '0' + sec : sec;\r\n\t\t\t\t\tmsg.length = min + ':' + sec;\r\n\t\t\t\t\tthis.sendMsg(msg, 'voice');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('取消发送录音');\r\n\t\t\t\t}\r\n\t\t\t\tthis.willStop = false;\r\n\t\t\t},\r\n\t\t\t// 切换语音/文字输入\r\n\t\t\tswitchVoice() {\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\tthis.isVoice = this.isVoice ? false : true;\r\n\t\t\t},\r\n\t\t\tdiscard() {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import \"css/style.scss\";\r\n\r\n\t.content .showLayer {\r\n\t\ttransform: translate3d(0, -43vw, 0);\r\n\t}\r\n</style>\n","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1704443778941\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}